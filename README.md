# TechBlog â€” ç§‘æŠ€ AI ä¸ªäººçŸ¥è¯†åº“

åŸºäº **Cloudflare Workers + Pages + D1** æ„å»ºçš„ Blog/Wiki ä¸ªäººç½‘ç«™ï¼Œå®Œå…¨è¿è¡Œåœ¨ Cloudflare è¾¹ç¼˜ç½‘ç»œï¼Œå…è´¹é¢åº¦è¶³å¤Ÿä¸ªäººä½¿ç”¨ã€‚

---

## âš¡ æœ¬åœ°é¢„è§ˆï¼ˆå®Œå…¨ä»é›¶å¼€å§‹ï¼Œæ— éœ€ä»»ä½•å‰ç½®å®‰è£…ï¼‰

`dev.sh` æ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨å¯åŠ¨è„šæœ¬ï¼Œ**ä»é›¶å¼€å§‹**è‡ªåŠ¨å¤„ç†æ‰€æœ‰æ­¥éª¤ï¼ŒåŒ…æ‹¬å®‰è£… Node.js å’Œ Wranglerã€‚D1 æ•°æ®åº“å…¨éƒ¨æœ¬åœ°æ¨¡æ‹Ÿï¼Œ**æ— éœ€ Cloudflare è´¦å·**ã€‚

### æ”¯æŒçš„ç³»ç»Ÿ

| ç³»ç»Ÿ | Node.js å®‰è£…æ–¹å¼ |
|------|----------------|
| macOS | è‡ªåŠ¨å®‰è£… Homebrew â†’ Node.js |
| Ubuntu / Debian | é€šè¿‡ NodeSource å®˜æ–¹æºå®‰è£… Node.js 20 |
| CentOS / RHEL / Fedora | é€šè¿‡ NodeSource rpm æºå®‰è£… Node.js 20 |
| å…¶ä»– Linux | é€šè¿‡ nvm å®‰è£… Node.js LTS |

### è¿è¡Œæ–¹å¼

è§£å‹é¡¹ç›®åï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥ `techblog/` ç›®å½•ï¼Œæ‰§è¡Œï¼š

```bash
bash dev.sh
```

è„šæœ¬ä¼š**å…¨è‡ªåŠ¨**å®Œæˆä»¥ä¸‹æ‰€æœ‰æ­¥éª¤ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼š

```
[1/5] æ£€æŸ¥ Node.js  â†’ æœªå®‰è£…åˆ™è‡ªåŠ¨å®‰è£…ï¼ˆmacOS/Ubuntu/CentOS/Linux å‡æ”¯æŒï¼‰
[2/5] æ£€æŸ¥ Wrangler â†’ æœªå®‰è£…åˆ™è‡ªåŠ¨é€šè¿‡ npm å®‰è£…
[3/5] å®‰è£…ä¾èµ–      â†’ npm install API å’Œå‰ç«¯æ‰€æœ‰ä¾èµ–
[4/5] åˆå§‹åŒ–æ•°æ®åº“  â†’ åˆ›å»ºæœ¬åœ° SQLiteï¼Œå†™å…¥ç¤ºä¾‹åˆ†ç±»/æ ‡ç­¾/æ–‡ç« 
[5/5] å¯åŠ¨æœåŠ¡      â†’ åå°å¯åŠ¨ API + å‰ç«¯ï¼Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
```

å¯åŠ¨å®Œæˆåç»ˆç«¯ä¼šæ˜¾ç¤ºï¼š

```
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘         ğŸš€  æœ¬åœ°é¢„è§ˆå·²å°±ç»ªï¼               â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ğŸŒ  ç½‘ç«™é¦–é¡µ   â†’  http://localhost:4321
  ğŸ”§  ç®¡ç†åå°   â†’  http://localhost:4321/admin
  ğŸ”Œ  API æ¥å£   â†’  http://localhost:8787

  ğŸ”‘  ç®¡ç†å¯†ç    â†’  dev-token-123
```

### å¸¸ç”¨å‘½ä»¤

```bash
bash dev.sh           # å¯åŠ¨ï¼ˆé¦–æ¬¡ä¼šè‡ªåŠ¨å®‰è£…æ‰€æœ‰ä¾èµ–ï¼‰
bash dev.sh --stop    # åœæ­¢æ‰€æœ‰åå°æœåŠ¡
bash dev.sh --reset   # é‡ç½®æ•°æ®åº“ï¼ˆæ¸…ç©ºæ•°æ®é‡æ–°åˆå§‹åŒ–ï¼Œä¿ç•™å·²å®‰è£…å·¥å…·ï¼‰
```

### æœ¬åœ°æ¨¡å¼è¯´æ˜

| èµ„æº | æœ¬åœ°å­˜å‚¨ä½ç½® | è¯´æ˜ |
|------|------------|------|
| D1 æ•°æ®åº“ | `api/.wrangler/state/v3/d1/` | æœ¬åœ° SQLite æ–‡ä»¶ |
| API æ—¥å¿— | `.dev-logs/api.log` | å®æ—¶è¾“å‡º |
| å‰ç«¯æ—¥å¿— | `.dev-logs/frontend.log` | å®æ—¶è¾“å‡º |

> **æ³¨æ„**ï¼šæœ¬åœ°é¢„è§ˆæ—¶å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½†ä¸Šä¼ åçš„å›¾ç‰‡ URL æ— æ³•åœ¨æµè§ˆå™¨ä¸­ç›´æ¥é¢„è§ˆï¼ˆå› ä¸ºæ²¡æœ‰å…¬å¼€ HTTP æœåŠ¡ï¼‰ï¼Œéƒ¨ç½²åˆ° Cloudflare åå›¾ç‰‡å³å¯æ­£å¸¸æ˜¾ç¤ºã€‚

---

## ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [éƒ¨ç½²å‰å‡†å¤‡](#éƒ¨ç½²å‰å‡†å¤‡)
- [å®Œæ•´éƒ¨ç½²æµç¨‹](#å®Œæ•´éƒ¨ç½²æµç¨‹)
  - [ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Cloudflare èµ„æº](#ç¬¬ä¸€æ­¥åˆ›å»º-cloudflare-èµ„æº)
  - [ç¬¬äºŒæ­¥ï¼šé…ç½® API](#ç¬¬äºŒæ­¥é…ç½®-api)
  - [ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“](#ç¬¬ä¸‰æ­¥åˆå§‹åŒ–æ•°æ®åº“)
  - [ç¬¬å››æ­¥ï¼šéƒ¨ç½² Workers API](#ç¬¬å››æ­¥éƒ¨ç½²-workers-api)
  - [ç¬¬äº”æ­¥ï¼šé…ç½®å¹¶éƒ¨ç½²å‰ç«¯](#ç¬¬äº”æ­¥é…ç½®å¹¶éƒ¨ç½²å‰ç«¯)
- [æœ¬åœ°å¼€å‘](#æœ¬åœ°å¼€å‘)
- [ä½¿ç”¨ç®¡ç†åå°](#ä½¿ç”¨ç®¡ç†åå°)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [Cloudflare å…è´¹é¢åº¦è¯´æ˜](#cloudflare-å…è´¹é¢åº¦è¯´æ˜)

---

## åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ“ Blog + ğŸ“š Wiki | åŒå†…å®¹æ¨¡å¼ï¼ŒBlog å‘åŸåˆ›æ–‡ç« ï¼ŒWiki æ•´ç†ç³»ç»Ÿç¬”è®° |
| âœï¸ Markdown å†™ä½œ | æ”¯æŒ GFM è¯­æ³•ã€ä»£ç é«˜äº®ï¼ˆhighlight.jsï¼‰ã€è¡¨æ ¼ã€ä»»åŠ¡åˆ—è¡¨ |
| ğŸ” å…¨æ–‡æœç´¢ | åŸºäº D1 FTS5 å¼•æ“ï¼Œæ”¯æŒä¸­è‹±æ–‡å…³é”®è¯æ£€ç´¢ï¼Œæ˜¾ç¤ºé«˜äº®æ‘˜è¦ |
| ğŸ—‚ï¸ åˆ†ç±» + æ ‡ç­¾ | å¤šç»´åº¦å†…å®¹ç»„ç»‡ï¼Œæ”¯æŒæŒ‰åˆ†ç±»/æ ‡ç­¾ç­›é€‰ |
| ğŸ–¼ï¸ å›¾ç‰‡ä¸Šä¼  | æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ ï¼ŒBase64 å­˜å…¥ D1ï¼Œé€šè¿‡ Worker æä¾›è®¿é—® |
| ğŸ” ç®¡ç†åå° | Token è®¤è¯ï¼Œæ–‡ç«  CRUDã€åˆ†ç±»/æ ‡ç­¾ç®¡ç†ã€æ•°æ®ç»Ÿè®¡ |
| ğŸ“– æ–‡ç« ç›®å½• | è‡ªåŠ¨æå– Markdown æ ‡é¢˜ç”Ÿæˆ TOCï¼Œæ»šåŠ¨é«˜äº®å½“å‰ç« èŠ‚ |
| ğŸ“± å“åº”å¼ | æ·±è‰²ä¸»é¢˜ï¼Œç§»åŠ¨ç«¯é€‚é…ï¼ŒTailwind CSS |
| âš¡ è¾¹ç¼˜éƒ¨ç½² | å…¨çƒ CDN åŠ é€Ÿï¼Œå†·å¯åŠ¨æå¿«ï¼Œæ— æœåŠ¡å™¨ç»´æŠ¤ |

---

## æŠ€æœ¯æ¶æ„

```
ç”¨æˆ·æµè§ˆå™¨
    â”‚
    â–¼
Cloudflare Pages     â† Astro é™æ€å‰ç«¯ï¼ˆå…¨çƒ CDNï¼‰
    â”‚
    â”‚  API è¯·æ±‚ï¼ˆfetchï¼‰
    â–¼
Cloudflare Workers   â† Hono.js åç«¯ APIï¼ˆè¾¹ç¼˜è®¡ç®—ï¼‰
    â”‚
    â–¼
Cloudflare D1
ï¼ˆSQLite æ•°æ®åº“ï¼šæ–‡ç«  / åˆ†ç±» / æ ‡ç­¾ / å›¾ç‰‡ï¼‰
```

> å›¾ç‰‡ä»¥ Base64 å­˜å…¥ D1ï¼Œé€šè¿‡ Worker çš„ `/api/media/:id` ç«¯ç‚¹ç›´æ¥æä¾›è®¿é—®ï¼Œæ— éœ€ R2ã€‚

**æŠ€æœ¯é€‰å‹ï¼š**

- **åç«¯**ï¼š[Hono.js](https://hono.dev/) on Cloudflare Workers â€” è½»é‡ã€TypeScript åŸç”Ÿ
- **æ•°æ®åº“**ï¼šCloudflare D1ï¼ˆSQLiteï¼‰+ FTS5 å…¨æ–‡æœç´¢ + media è¡¨å­˜å‚¨å›¾ç‰‡
- **å‰ç«¯**ï¼š[Astro](https://astro.build/) é™æ€ç”Ÿæˆ + Tailwind CSS
- **éƒ¨ç½²**ï¼šCloudflare Pagesï¼ˆå‰ç«¯ï¼‰+ Workersï¼ˆAPIï¼‰

---

## é¡¹ç›®ç»“æ„

```
techblog/
â”œâ”€â”€ README.md
â”œâ”€â”€ deploy.sh                          # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”‚
â”œâ”€â”€ api/                               # Cloudflare Workers åç«¯
â”‚   â”œâ”€â”€ wrangler.toml                  # âš ï¸ éœ€è¦å¡«å†™ database_id
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ schema.sql                     # D1 æ•°æ®åº“ç»“æ„ + ç§å­æ•°æ®
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts                   # å…¥å£æ–‡ä»¶ï¼Œè·¯ç”±æŒ‚è½½
â”‚       â”œâ”€â”€ types.ts                   # TypeScript ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ middleware/
â”‚       â”‚   â””â”€â”€ auth.ts                # Bearer Token è®¤è¯ä¸­é—´ä»¶
â”‚       â””â”€â”€ routes/
â”‚           â”œâ”€â”€ articles.ts            # å…¬å¼€æ–‡ç« è¯»å–æ¥å£
â”‚           â”œâ”€â”€ search.ts              # FTS5 å…¨æ–‡æœç´¢æ¥å£
â”‚           â”œâ”€â”€ taxonomy.ts            # åˆ†ç±»/æ ‡ç­¾æŸ¥è¯¢æ¥å£
â”‚           â”œâ”€â”€ admin.ts               # ç®¡ç† CRUDï¼ˆéœ€è®¤è¯ï¼‰
â”‚           â””â”€â”€ upload.ts              # å›¾ç‰‡ä¸Šä¼ /æä¾›ï¼ˆå­˜å…¥ D1ï¼‰
â”‚
â””â”€â”€ frontend/                          # Astro å‰ç«¯
    â”œâ”€â”€ astro.config.mjs
    â”œâ”€â”€ tailwind.config.mjs
    â”œâ”€â”€ wrangler.toml
    â”œâ”€â”€ package.json
    â”œâ”€â”€ .env.example                   # âš ï¸ å¤åˆ¶ä¸º .env å¹¶å¡«å†™
    â””â”€â”€ src/
        â”œâ”€â”€ lib/
        â”‚   â”œâ”€â”€ api.ts                 # API å®¢æˆ·ç«¯å°è£…
        â”‚   â””â”€â”€ markdown.ts            # Markdown æ¸²æŸ“ï¼ˆå«ä»£ç é«˜äº®ï¼‰
        â”œâ”€â”€ styles/
        â”‚   â””â”€â”€ global.css             # å…¨å±€æ ·å¼ + æ·±è‰²ä¸»é¢˜
        â”œâ”€â”€ components/
        â”‚   â”œâ”€â”€ Navbar.astro
        â”‚   â”œâ”€â”€ Footer.astro
        â”‚   â”œâ”€â”€ ArticleCard.astro
        â”‚   â””â”€â”€ Pagination.astro
        â”œâ”€â”€ layouts/
        â”‚   â”œâ”€â”€ BaseLayout.astro       # HTML åŸºç¡€ç»“æ„ + SEO meta
        â”‚   â””â”€â”€ SiteLayout.astro       # å«å¯¼èˆªæ /é¡µè„šçš„å®Œæ•´å¸ƒå±€
        â””â”€â”€ pages/
            â”œâ”€â”€ index.astro            # é¦–é¡µ
            â”œâ”€â”€ search.astro           # å…¨æ–‡æœç´¢é¡µ
            â”œâ”€â”€ 404.astro              # 404 é¡µé¢
            â”œâ”€â”€ blog/
            â”‚   â”œâ”€â”€ index.astro        # Blog åˆ—è¡¨ï¼ˆå«ç­›é€‰ä¾§æ ï¼‰
            â”‚   â””â”€â”€ [slug].astro       # Blog æ–‡ç« è¯¦æƒ…ï¼ˆå«ç›®å½•ï¼‰
            â”œâ”€â”€ wiki/
            â”‚   â”œâ”€â”€ index.astro        # Wiki åˆ—è¡¨ï¼ˆæŒ‰åˆ†ç±»åˆ†ç»„ï¼‰
            â”‚   â””â”€â”€ [slug].astro       # Wiki æ–‡ç« è¯¦æƒ…ï¼ˆå«ç›®å½•ï¼‰
            â””â”€â”€ admin/
                â””â”€â”€ index.astro        # ç®¡ç†åå°ï¼ˆToken ç™»å½•ï¼‰
```

---

## éƒ¨ç½²å‰å‡†å¤‡

### ç¯å¢ƒè¦æ±‚

- **Node.js** 18 æˆ–ä»¥ä¸Š
- **npm** 9 æˆ–ä»¥ä¸Šï¼ˆNode.js è‡ªå¸¦ï¼‰
- **Wrangler CLI**ï¼ˆCloudflare å®˜æ–¹å‘½ä»¤è¡Œå·¥å…·ï¼‰
- **Cloudflare è´¦å·**ï¼ˆå…è´¹å³å¯ï¼‰

### å®‰è£… Wrangler å¹¶ç™»å½•

```bash
# å…¨å±€å®‰è£… Wrangler
npm install -g wrangler

# ç™»å½• Cloudflareï¼ˆä¼šæ‰“å¼€æµè§ˆå™¨æˆæƒï¼‰
wrangler login

# éªŒè¯ç™»å½•çŠ¶æ€
wrangler whoami
```

---

## å®Œæ•´éƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Cloudflare èµ„æº

**åˆ›å»º D1 æ•°æ®åº“ï¼š**

```bash
wrangler d1 create techblog-db
```

æ‰§è¡Œåä¼šè¾“å‡ºç±»ä¼¼ï¼š

```
âœ… Successfully created DB 'techblog-db'
{
  "uuid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "name": "techblog-db"
}
```

âš ï¸ **è®°å½•è¿™ä¸ª `uuid`**ï¼Œä¸‹ä¸€æ­¥éœ€è¦å¡«å…¥é…ç½®æ–‡ä»¶ã€‚

---

### ç¬¬äºŒæ­¥ï¼šé…ç½® API

æ‰“å¼€ `api/wrangler.toml`ï¼Œå°† `database_id` æ›¿æ¢ä¸ºä¸Šä¸€æ­¥è®°å½•çš„ uuidï¼š

```toml
[[d1_databases]]
binding = "DB"
database_name = "techblog-db"
database_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"  # â† å¡«ä½ çš„ uuid
```

åŒæ—¶ä¿®æ”¹å…è®¸çš„å‰ç«¯åŸŸåï¼ˆCORSï¼‰ï¼š

```toml
[vars]
ALLOWED_ORIGIN = "https://techblog.pages.dev"
```

**è®¾ç½®ç®¡ç†å‘˜ Tokenï¼ˆå¯†é’¥ï¼‰ï¼š**

```bash
cd api
wrangler secret put ADMIN_TOKEN
# æç¤ºè¾“å…¥æ—¶ï¼Œè¾“å…¥ä¸€ä¸ªå¼ºå¯†ç ï¼ˆå¦‚ï¼šMyBlog@2025!ï¼‰
# è¿™ä¸ªå¯†ç ç”¨äºä¿æŠ¤ç®¡ç†æ¥å£ï¼Œè¯·å¦¥å–„ä¿å­˜
```

---

### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“

**æœ¬åœ°é¢„è§ˆç”¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š**

```bash
cd api
wrangler d1 execute techblog-db --file=./schema.sql
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆå¿…é¡»æ‰§è¡Œï¼‰ï¼š**

```bash
wrangler d1 execute techblog-db --remote --file=./schema.sql
```

æ‰§è¡ŒæˆåŠŸåï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ›å»ºæ‰€æœ‰è¡¨ç»“æ„ï¼Œå¹¶æ’å…¥ç¤ºä¾‹åˆ†ç±»ã€æ ‡ç­¾å’Œ 3 ç¯‡ç¤ºä¾‹æ–‡ç« ã€‚

---

### ç¬¬å››æ­¥ï¼šéƒ¨ç½² Workers API

```bash
cd api
npm install
wrangler deploy
```

éƒ¨ç½²æˆåŠŸåä¼šè¾“å‡º Workers URLï¼Œä¾‹å¦‚ï¼š

```
âœ… Deployed techblog-api to https://techblog-api.yourname.workers.dev
```

**âš ï¸ è®°å½•è¿™ä¸ª URL**ï¼Œå‰ç«¯éœ€è¦ç”¨åˆ°ã€‚

**éªŒè¯ API æ˜¯å¦æ­£å¸¸ï¼š**

```bash
curl https://techblog-api.yourname.workers.dev/
# åº”è¿”å›: {"status":"ok","service":"TechBlog API","version":"1.0.0",...}
```

---

### ç¬¬äº”æ­¥ï¼šé…ç½®å¹¶éƒ¨ç½²å‰ç«¯

**é…ç½®ç¯å¢ƒå˜é‡ï¼š**

```bash
cd frontend
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥å®é™…å€¼ï¼š

```bash
# Workers API åœ°å€ï¼ˆç¬¬å››æ­¥å¾—åˆ°çš„ URLï¼‰
PUBLIC_API_URL=https://techblog-api.yourname.workers.dev

# ç®¡ç†å‘˜ Tokenï¼ˆä¸ç¬¬äºŒæ­¥è®¾ç½®çš„ ADMIN_TOKEN ç›¸åŒï¼‰
PUBLIC_ADMIN_TOKEN=MyBlog@2025!

# ç½‘ç«™åŸºæœ¬ä¿¡æ¯ï¼ˆæ ¹æ®è‡ªå·±æƒ…å†µä¿®æ”¹ï¼‰
PUBLIC_SITE_NAME=AI & ç§‘æŠ€ç¬”è®°
PUBLIC_SITE_DESCRIPTION=è®°å½•AIä¸ç§‘æŠ€çš„æ€è€ƒä¸æ¢ç´¢
PUBLIC_AUTHOR=ä½ çš„åå­—
PUBLIC_AUTHOR_GITHUB=https://github.com/yourusername
PUBLIC_AUTHOR_TWITTER=https://twitter.com/yourusername
```

**æœ¬åœ°é¢„è§ˆï¼ˆå¯é€‰ï¼‰ï¼š**

```bash
npm install
npm run dev
# æ‰“å¼€ http://localhost:4321 é¢„è§ˆç½‘ç«™
```

**æ„å»ºå¹¶éƒ¨ç½²åˆ° Pagesï¼š**

```bash
npm run build
wrangler pages deploy ./dist --project-name=techblog
```

é¦–æ¬¡éƒ¨ç½²ä¼šè¯¢é—®æ˜¯å¦åˆ›å»ºæ–°é¡¹ç›®ï¼Œé€‰æ‹© **Yes**ã€‚

éƒ¨ç½²æˆåŠŸåä¼šè¾“å‡ºç±»ä¼¼ï¼š

```
âœ… Deployment complete!
https://techblog.pages.dev
```

**æ›´æ–° CORS é…ç½®ï¼š**

å¾—åˆ° Pages URL åï¼Œå›åˆ° `api/wrangler.toml`ï¼Œæ›´æ–° `ALLOWED_ORIGIN`ï¼š

```toml
ALLOWED_ORIGIN = "https://techblog.pages.dev"
```

ç„¶åé‡æ–°éƒ¨ç½² APIï¼š

```bash
cd api
wrangler deploy
```

ğŸ‰ **è‡³æ­¤ï¼Œç½‘ç«™å·²å®Œæ•´éƒ¨ç½²å®Œæˆï¼**

---

## æœ¬åœ°å¼€å‘

åŒæ—¶å¯åŠ¨ API å’Œå‰ç«¯è¿›è¡Œæœ¬åœ°è”è°ƒï¼š

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ Workers APIï¼ˆæœ¬åœ°æ¨¡æ‹Ÿï¼‰
cd api
npm install
wrangler dev
# API è¿è¡Œåœ¨ http://localhost:8787

# ç»ˆç«¯ 2ï¼šå¯åŠ¨ Astro å‰ç«¯
cd frontend
npm install
# ç¡®ä¿ .env ä¸­ PUBLIC_API_URL=http://localhost:8787
npm run dev
# å‰ç«¯è¿è¡Œåœ¨ http://localhost:4321
```

æœ¬åœ°å¼€å‘æ—¶ï¼ŒD1 ä½¿ç”¨æœ¬åœ° SQLite æ–‡ä»¶æ¨¡æ‹Ÿï¼Œæ•°æ®ä¸è¿œç¨‹éš”ç¦»ï¼Œä¸å½±å“ç”Ÿäº§ç¯å¢ƒã€‚

**æœ¬åœ°åˆå§‹åŒ–å¼€å‘æ•°æ®åº“ï¼š**

```bash
cd api
wrangler d1 execute techblog-db --file=./schema.sql
# æ³¨æ„ï¼šä¸åŠ  --remote å°±æ˜¯å†™å…¥æœ¬åœ°å¼€å‘æ•°æ®åº“
```

---

## ä½¿ç”¨ç®¡ç†åå°

è®¿é—® `https://ä½ çš„åŸŸå/admin`ï¼Œè¿›å…¥ç®¡ç†åå°ã€‚

### ç™»å½•

è¾“å…¥ä½ åœ¨ç¬¬äºŒæ­¥è®¾ç½®çš„ `ADMIN_TOKEN` å³å¯ç™»å½•ã€‚Token ä¼šä¿å­˜åœ¨ `sessionStorage`ï¼Œå…³é—­æ ‡ç­¾é¡µåéœ€é‡æ–°ç™»å½•ã€‚

### å†™ä½œå‘å¸ƒæµç¨‹

1. ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªã€Œ**å†™ä½œ**ã€æ ‡ç­¾
2. å¡«å†™æ ‡é¢˜ï¼ˆSlug ä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œä¹Ÿå¯æ‰‹åŠ¨ä¿®æ”¹ï¼‰
3. åœ¨æ­£æ–‡åŒºåŸŸç”¨ Markdown ç¼–å†™å†…å®¹ï¼Œç‚¹å‡»ã€Œé¢„è§ˆã€å¯å®æ—¶æ¸²æŸ“
4. åœ¨å³ä¾§è®¾ç½®é¢æ¿é€‰æ‹©ç±»å‹ï¼ˆBlog / Wikiï¼‰ã€åˆ†ç±»ã€æ ‡ç­¾
5. å¯æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ å°é¢å›¾ç‰‡ï¼ˆBase64 å­˜å…¥ D1ï¼Œæœ€å¤§ 2MBï¼‰
6. ç‚¹å‡»ã€Œ**å‘å¸ƒ**ã€ç«‹å³å‘å¸ƒï¼Œæˆ–ã€Œ**ä¿å­˜è‰ç¨¿**ã€æš‚å­˜

### ç®¡ç†ç°æœ‰æ–‡ç« 

1. åˆ‡æ¢åˆ°ã€Œ**æ–‡ç« **ã€æ ‡ç­¾ï¼ŒæŸ¥çœ‹æ‰€æœ‰æ–‡ç« åˆ—è¡¨
2. å¯æŒ‰ç±»å‹ï¼ˆBlog/Wikiï¼‰å’ŒçŠ¶æ€ï¼ˆå·²å‘å¸ƒ/è‰ç¨¿ï¼‰ç­›é€‰
3. ç‚¹å‡»ã€Œç¼–è¾‘ã€è¿›å…¥ç¼–è¾‘å™¨ï¼Œä¿®æ”¹åé‡æ–°å‘å¸ƒ
4. ç‚¹å‡» ğŸ”— å›¾æ ‡å¯åœ¨æ–°æ ‡ç­¾é¡µé¢„è§ˆæ–‡ç« 
5. ç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œå³ä¾§åº•éƒ¨ã€Œå±é™©æ“ä½œã€åŒºåŸŸå¯åˆ é™¤æ–‡ç« 

### ç®¡ç†åˆ†ç±»å’Œæ ‡ç­¾

åˆ‡æ¢åˆ°ã€Œ**åˆ†ç±»/æ ‡ç­¾**ã€æ ‡ç­¾ï¼š

- ç‚¹å‡»ã€Œ+ æ–°å»ºåˆ†ç±»ã€å¡«å†™åç§°ã€Slug å’Œé¢œè‰²
- ç‚¹å‡»ã€Œ+ æ–°å»ºæ ‡ç­¾ã€å¡«å†™åç§°å’Œ Slug
- ç‚¹å‡»åˆ†ç±»/æ ‡ç­¾å³ä¾§çš„ Ã— åˆ é™¤ï¼ˆå·²å…³è”æ–‡ç« çš„ä¸å»ºè®®åˆ é™¤ï¼‰

### æ•°æ®ç»Ÿè®¡

åˆ‡æ¢åˆ°ã€Œ**ç»Ÿè®¡**ã€æ ‡ç­¾ï¼ŒæŸ¥çœ‹æ€»æ–‡ç« æ•°ã€å‘å¸ƒæ•°ã€è‰ç¨¿æ•°ã€æ€»æµè§ˆé‡ã€åˆ†ç±»æ•°ã€æ ‡ç­¾æ•°ã€‚

---

## å¸¸è§é—®é¢˜

**Qï¼šAPI è¯·æ±‚å¤±è´¥ï¼Œå‰ç«¯æŠ¥ CORS é”™è¯¯ï¼Ÿ**

æ£€æŸ¥ `api/wrangler.toml` ä¸­çš„ `ALLOWED_ORIGIN` æ˜¯å¦ä¸ä½ çš„å‰ç«¯å®é™…åŸŸåä¸€è‡´ï¼Œä¿®æ”¹åé‡æ–°æ‰§è¡Œ `wrangler deploy`ã€‚

**Qï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸä½†æ— æ³•æ˜¾ç¤ºï¼Ÿ**

å›¾ç‰‡é€šè¿‡ Worker çš„ `/api/media/:id` æ¥å£æä¾›è®¿é—®ï¼Œç¡®è®¤ Workers API å·²æ­£å¸¸éƒ¨ç½²ï¼Œå‰ç«¯çš„ `PUBLIC_API_URL` å¡«å†™æ­£ç¡®ã€‚

**Qï¼šç®¡ç†åå°ç™»å½•æç¤º Token é”™è¯¯ï¼Ÿ**

ç¡®è®¤ `.env` ä¸­çš„ `PUBLIC_ADMIN_TOKEN` ä¸ `wrangler secret put ADMIN_TOKEN` æ—¶è¾“å…¥çš„å€¼å®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚

**Qï¼šæœç´¢ä¸­æ–‡æ—¶æ²¡æœ‰ç»“æœï¼Ÿ**

D1 FTS5 å¯¹ä¸­æ–‡ä½¿ç”¨å­—ç¬¦çº§åˆ†è¯ï¼Œæœç´¢æ•ˆæœæœ‰é™ã€‚å»ºè®®æœç´¢æ—¶ä½¿ç”¨ 2-4 ä¸ªå­—çš„å…³é”®è¯ï¼Œé¿å…æœç´¢é•¿å¥ã€‚å¦‚éœ€æ›´å¥½çš„ä¸­æ–‡æœç´¢ä½“éªŒï¼Œå¯è€ƒè™‘æ¥å…¥ Cloudflare Vectorize åšè¯­ä¹‰æœç´¢ã€‚

**Qï¼šå¦‚ä½•ç»‘å®šè‡ªå®šä¹‰åŸŸåï¼Ÿ**

- **APIï¼ˆWorkersï¼‰**ï¼šDashboard â†’ Workers & Pages â†’ techblog-api â†’ Settings â†’ Triggers â†’ Custom Domains
- **å‰ç«¯ï¼ˆPagesï¼‰**ï¼šDashboard â†’ Workers & Pages â†’ techblog â†’ Custom Domains

**Qï¼šæœ¬åœ°é¢„è§ˆæ—¶å›¾ç‰‡ä¸Šä¼ åæ— æ³•æ˜¾ç¤ºï¼Ÿ**

æœ¬åœ°é¢„è§ˆæ—¶å›¾ç‰‡å­˜å…¥æœ¬åœ° D1ï¼Œé€šè¿‡ `http://localhost:8787/api/media/:id` è®¿é—®ï¼Œå‰ç«¯åŠ è½½æ—¶éœ€è¦ç¡®ä¿ API æ­£åœ¨è¿è¡Œï¼ˆ`wrangler dev` å·²å¯åŠ¨ï¼‰ã€‚

**Qï¼š`bash dev.sh` æç¤ºç«¯å£è¢«å ç”¨ï¼Ÿ**

è„šæœ¬ä¼šè‡ªåŠ¨å°è¯•é‡Šæ”¾ç«¯å£ï¼Œå¦‚ä»ç„¶å¤±è´¥ï¼Œæ‰‹åŠ¨æ‰§è¡Œï¼š
```bash
lsof -ti:8787 | xargs kill -9
lsof -ti:4321 | xargs kill -9
```

**Qï¼šæœ¬åœ°æ•°æ®åº“çš„æ•°æ®å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ**

æ•°æ®å­˜å‚¨åœ¨ `api/.wrangler/state/v3/d1/` ç›®å½•ä¸‹çš„ SQLite æ–‡ä»¶ï¼Œåªè¦ä¸æ‰§è¡Œ `--reset`ï¼Œæ•°æ®ä¼šä¸€ç›´ä¿ç•™ã€‚

**Qï¼šå¦‚ä½•æ›´æ–°å·²éƒ¨ç½²çš„ç½‘ç«™ï¼Ÿ**

```bash
# æ›´æ–° API
cd api && wrangler deploy

# æ›´æ–°å‰ç«¯
cd frontend && npm run build && wrangler pages deploy ./dist --project-name=techblog
```

---

## Cloudflare å…è´¹é¢åº¦è¯´æ˜

| æœåŠ¡ | å…è´¹é¢åº¦ | è¯´æ˜ |
|------|---------|------|
| Workers | 10 ä¸‡è¯·æ±‚/å¤© | API è°ƒç”¨æ¬¡æ•° |
| Pages | æ— é™è¯·æ±‚ | å‰ç«¯é™æ€èµ„æº |
| D1 | 500 MB å­˜å‚¨ï¼Œ500 ä¸‡è¡Œè¯»/å¤© | æ•°æ®åº“ |

å¯¹äºä¸ªäººåšå®¢/çŸ¥è¯†åº“ï¼Œä»¥ä¸Šé¢åº¦**å®Œå…¨å…è´¹ï¼Œæ— éœ€ä»˜è´¹**ã€‚

---

## API æ¥å£å‚è€ƒ

æ‰€æœ‰æ¥å£åŸºç¡€è·¯å¾„ï¼š`https://techblog-api.yourname.workers.dev`

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | éœ€è¦è®¤è¯ |
|------|------|------|---------|
| GET | `/api/articles` | è·å–æ–‡ç« åˆ—è¡¨ï¼Œæ”¯æŒ `type/category/tag/page` å‚æ•° | å¦ |
| GET | `/api/articles/:slug` | è·å–å•ç¯‡æ–‡ç« è¯¦æƒ… | å¦ |
| GET | `/api/search?q=å…³é”®è¯` | å…¨æ–‡æœç´¢ | å¦ |
| GET | `/api/categories` | è·å–æ‰€æœ‰åˆ†ç±» | å¦ |
| GET | `/api/tags` | è·å–æ‰€æœ‰æ ‡ç­¾ | å¦ |
| GET | `/api/admin/articles` | è·å–æ‰€æœ‰æ–‡ç« ï¼ˆå«è‰ç¨¿ï¼‰ | âœ… |
| POST | `/api/admin/articles` | åˆ›å»ºæ–‡ç«  | âœ… |
| PUT | `/api/admin/articles/:slug` | æ›´æ–°æ–‡ç«  | âœ… |
| DELETE | `/api/admin/articles/:slug` | åˆ é™¤æ–‡ç«  | âœ… |
| POST | `/api/admin/categories` | åˆ›å»ºåˆ†ç±» | âœ… |
| POST | `/api/admin/tags` | åˆ›å»ºæ ‡ç­¾ | âœ… |
| GET | `/api/admin/stats` | è·å–ç»Ÿè®¡æ•°æ® | âœ… |
| POST | `/api/upload/image` | ä¸Šä¼ å›¾ç‰‡åˆ° D1ï¼ˆmultipart/form-dataï¼Œæœ€å¤§ 2MBï¼‰ | âœ… |
| GET | `/api/media/:id` | è·å–å›¾ç‰‡ï¼ˆç›´æ¥è¿”å›äºŒè¿›åˆ¶ï¼‰ | å¦ |

è®¤è¯æ–¹å¼ï¼šè¯·æ±‚å¤´æ·»åŠ  `Authorization: Bearer <ADMIN_TOKEN>`
